FROM node:19 AS build
COPY . /usr/src/app/
WORKDIR /usr/src/app/
RUN ./gen.sh

FROM node:19
WORKDIR /usr/src/app/
COPY --from=build /usr/src/app/certs/cacert.pem /usr/src/app/certs/server.*pem ./
COPY server.js .
ENTRYPOINT ["docker-entrypoint.sh"]
CMD [ "node", "server.js" ]
